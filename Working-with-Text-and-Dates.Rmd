---
title: "Working with Text and Dates"
author: "Michael Kistner"
date: "May 16, 2022"
output: 
  html_document:
    toc: true
---

```{r echo=FALSE}
options(scipen = 999,
        max.print = 20)
```

# Introduction

To cover these concepts, we're going to introduce a new dataset, `House Tweets.Rda`. This dataset contains the set of tweets authored by U.S. Representatives during the 2020 election year, from January to November. The dataset, which was downloaded directly from Twitter's API, contains the representative's name, their state and district, the date the tweet was posted, and the text of the tweet. 

Let's begin by loading the **tidyverse** package, the dataset, and get started.

```{r, warning=FALSE, message=FALSE}
library(tidyverse)

load("Data/House Tweets.Rda")
```

# String manipulation

Let's begin by covering some of the ways we can manipulate strings using the **stringr** package. One of the most common tasks in data cleaning is dealing with messy text data that needs to be tidied, coerced, or augmented in various ways. While base R contains functions that can accomplish most of the same things, the syntax of **stringr** is more consistent and commands usually behave in more predictable ways.

One of the most basic tasks is combining multiple strings into one. We accomplish this using `str_c()`, short for concatenate string. The function behaves similarly to `paste()` from base R, although it doesn't add any separation between strings unless you explicitly tell it to. For example, suppose we wanted to combine the following two strings describing what we're doing in this notebook:

```{r}
str_c("Learning how to",
      "clean text data with stringr")
```

the `str_c()` command joins the two strings into a single string, but without specifying that there should be space between them. 90\% of the time I combine strings I do not want a space, but since we do here, we can specify it using the `sep = ""` argument, where we can specify anything we want to separate the strings with. Let's add a space. 

```{r}
str_c("Learning how to",
      "clean data with stringr",
      sep = " ")
```

Looks good. Let's examine a more realistic data cleaning task where combining strings comes in handy. Suppose we want to create a `state_district` variable, where the representative's district is written as the two-letter state initial followed by the two-digit district number, separated by a hyphen, which is a common format in dataset. We could write the code below, which combines the `str_c()` command with a `mutate()` to create a new variable in our dataframe. 

```{r}
house_tweets <- house_tweets %>%
  mutate(state_district = str_c(state, district, sep = "-"))

house_tweets %>%
  select(name, state, district, state_district)
```

```{r}
house_tweets <- house_tweets %>% 
  mutate(district_full = str_pad(district, 
                                 width = 2, 
                                 side = "left",
                                 pad = "0"),
         state_district = str_c(state, district_full, sep = "-"))

house_tweets %>%
  select(name, state, district_full, state_district)
```

```{r}
str_split(house_tweets$state_district, "-", simplify = TRUE)
```

```{r}
str_sub(house_tweets$state_district, 1, 2)
str_sub(house_tweets$state_district, 4, 5)
```


```{r}
house_tweets %>%
  mutate(name_lower = str_to_lower(name),
         name_title = str_to_title(name)) %>%
  select(name, name_lower, name_title)
```

# Regular expressions

```{r}
the_tweet <- house_tweets$text[str_detect(house_tweets$text, "Sasquatch") & str_detect(house_tweets$text, "SpongeBob")]
```

```{r}
the_tweet
```

```{r}
str_view(the_tweet, "SpongeBob")
```
```{r}
str_view(the_tweet, "spongebob")
```

```{r}
str_view(the_tweet, "Sponge...")
```
```{r}
str_view(the_tweet, "\\.")
```
```{r}
str_view_all(the_tweet, "\\.")
```

```{r}
str_view_all(the_tweet, "\\d")
str_view_all(the_tweet, "\\s")
```


```{r}
str_view_all(the_tweet, "[ab]")
```

```{r}
house_tweets %>% 
  filter(str_detect(text, "Loch Ness")) %>%
  select(text)
```

```{r}
house_tweets %>% 
  filter(str_detect(text, "[Ss]ponge[Bb]ob")) %>%
  select(text)
```

```{r}
house_tweets %>% 
  filter(str_detect(text, regex("kendrick", ignore_case = TRUE))) %>% View()
  select(text)
```  

```{r}
house_tweets %>%
  pull(text) %>%
  str_extract(regex("kanye|kendricklamar|kendrick lamar", ignore_case = TRUE)) %>%
  na.exclude() %>%
  table()
```

```{r}
dir("Data")
```

# Working with dates

```{r}
range(house_tweets$date)
```

