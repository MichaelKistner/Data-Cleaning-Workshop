---
title: "Data Transformation"
author: "Michael Kistner"
date: "May 16, 2022"
output: 
  html_document:
    toc: true
---

```{r echo=FALSE}
options(scipen = 999)
```

# Introduction


In case it's not already loaded, let's load the **tidyverse** package and dive in.

```{r}
library(tidyverse)
```

# Test

```{r}
cands <- read_delim("Data/webl20.txt",
                    delim = "|",
                    col_names = FALSE, 
                    trim_ws = TRUE,
                    escape_double = FALSE) %>%
  setNames(c("cand_id", "name", "incumbency_status", "party_code",
             "party_affil", "total_receipts", "transfers_from_cmte",
              "disbursements", "transfers_to_cmte", "beginning_cash",
              "ending_cash", "cand_contributions", "cand_loans",
              "other_loans", "cand_loan_repayments", "other_loan_repayments",
              "debts_owed", "indiv_contributions", "office_state",
              "district", "spec_election", "prim_election", "runoff_election",
              "general_election", "general_election_pct", "cmte_contributions",
              "party_contributions", "coverage_end", "individ_refunds",
              "cmte_refunds")) %>%
  filter(district != "00", incumbency_status == "I")
```

```{r}
cand_cmte_link <- read_delim("Data/ccl.txt",
                  delim = "|", escape_double = FALSE,
                  col_names = FALSE,
                  trim_ws = TRUE) %>%
  setNames(c("cand_id", "cand_election_yr",
             "fec_election_year", "pcc_id",
             "cmte_type", "cmte_designation", "linkage_id")) 
```

```{r}
load("Data/Individual Contributions.Rda")
```

```{r}
group_by(cand_cmte_link,
         cand_id) %>%
  summarize(num_cmtes = n()) %>%
  arrange(desc(num_cmtes))
```

```{r}
cands <- select(c(cand_cmte_link,
                cand_id, pcc_id)) %>%
  left_join(cands, .)
```

```{r}
sum(is.na(cands$pcc_id))
```

```{r}
filter(cands, is.na(pcc_id))
```

```{r}
contribs <- cands %>%
  select(c(pcc_id, name, party_affil, office_state, district)) %>%
  left_join(contribs, .)
```

